function DeepShare(i){this._DSCallbacks={weixinIOSTipCallback:null,weixinAndroidTipCallback:null,weiboIOSTipCallback:null,weiboAndroidTipCallback:null,qqIOSTipCallback:null,qqAndroidTipCallback:null,cannotDeeplinkCallback:null,iosLandingCallback:null,androidMarketLandingCallback:null,androidDownloadLandingCallback:null,androidCannotGoMarketLandingCallback:null,iosPlatformNotAvailCallback:null,androidPlatformNotAvailCallback:null},this.app_id=i,this.BindParams=function(i){i.app_id=this.app_id;var e=new DeepShareWorker(i);return e.__proto__=this,e},this.SetCallbackWeixinIOSTip=function(i){this._DSCallbacks.weixinIOSTipCallback=i},this.SetCallbackWeixinAndroidTip=function(i){this._DSCallbacks.weixinAndroidTipCallback=i},this.SetCallbackWeiboIOSTip=function(i){this._DSCallbacks.weiboIOSTipCallback=i},this.SetCallbackWeiboAndroidTip=function(i){this._DSCallbacks.weiboAndroidTipCallback=i},this.SetCallbackQQIOSTip=function(i){this._DSCallbacks.qqIOSTipCallback=i},this.SetCallbackQQAndroidTip=function(i){this._DSCallbacks.qqAndroidTipCallback=i},this.SetCallbackQQAndroidTip=function(i){this._DSCallbacks.qqAndroidTipCallback=i},this.SetCallbackIOSNotAvailable=function(i){this._DSCallbacks.iosPlatformNotAvailCallback=i},this.SetCallbackAndroidNotAvailable=function(i){this._DSCallbacks.androidPlatformNotAvailCallback=i},this.SetCallbackCannotDeeplink=function(i){this._DSCallbacks.cannotDeeplinkCallback=i},this.SetCallbackIOSLanding=function(i){this._DSCallbacks.iosLandingCallback=i},this.SetCallbackAndroidMarketLanding=function(i){this._DSCallbacks.androidMarketLandingCallback=i},this.SetCallbackAndroidDownloadLanding=function(i){this._DSCallbacks.androidDownloadLandingCallback=i},this.SetCallbackAndroidCannotGoMarketLanding=function(i){this._DSCallbacks.androidCannotGoMarketLandingCallback=i}}function DeepShareWorker(i){var e=this,n={INITIAL:0,BINDED:1,DISMISSED:2},a="https://",o="fds.so/",d="v2/",t="jsapi/",l="ds_tag",s="",r="",c=n.INITIAL,u={inapp_data:"",sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},b=null,p={windowLocation:function(i){window.location=i},windowOpen:function(i){window.open(i)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(i,e){window.addEventListener(i,e)},windowUrlAddTag:function(){if(window.location.search.indexOf(l)<0){var i=Math.floor(1e6*Math.random()),e="?"+l+"="+i;window.location.search=e,DeepShare.dsLogDebug("Url Add Tag:"+e)}},cookieEnabled:function(){var i=!1;try{localStorage.test=2}catch(e){DeepShare.dsLogDebug("private mode"),i=!0}return navigator.cookieEnabled&&!i}},D={trackingUrl:"v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},g=function(i){IsNullOrUndefined(i.app_id)||(u.app_id=i.app_id),IsNullOrUndefined(i.inapp_data)||(u.inapp_data=JSON.stringify(i.inapp_data)),IsNullOrUndefined(i.sender_id)||(u.sender_id=i.sender_id),IsNullOrUndefined(i.download_title)||(u.download_title=i.download_title),IsNullOrUndefined(i.download_msg)||(u.download_msg=i.download_msg),IsNullOrUndefined(i.download_btn_text)||(u.download_btn_text=i.download_btn_text),IsNullOrUndefined(i.download_url_ios)||(u.download_url_ios=i.download_url_ios),IsNullOrUndefined(i.download_url_android)||(u.download_url_android=i.download_url_android),IsNullOrUndefined(i.channels)||(u.channels=JSON.stringify(i.channels)),IsNullOrUndefined(i.callbacks)||(e._DSCallbacks=i.callbacks),S(!0)},S=function(e){if(DeepShare.dsLogDebug("Try refresh bind, force: "+e+", binded: "+c+", inapp_data: "+JSON.stringify(u)),e||c!==n.BINDED){var l=a+o+d+t+u.app_id;$.ajax({url:l,type:"POST",data:JSON.stringify(u),xhrFields:{withCredentials:!0},success:function(e){b=e,c=n.BINDED,DeepShare.dsLogDebug("Params from api:"+JSON.stringify(i)+JSON.stringify(e))},error:function(i,e){DeepShare.dsLogDebug("Refresh Params Error: "+JSON.stringify(i)+", info: "+e)},dataType:"json"})}},k=function(i,e){var n={action:i,kvs:{click_id:b.match_id,destination:e,ds_tag:b.ds_tag}},d=a+o+D.trackingUrl+b.app_id,t=JSON.stringify(n);$.post(d,t,function(i){}).error(function(){})},_=function(i){p.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(i)}),p.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(i)}),p.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(i)}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(i))}),p.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(i)}),p.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),p.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(i)})};_gotoTip=function(i,n){if(DeepShare.dsLogDebug("Go to tip: "+n),"ios"===i)switch(n){case D.destination.dstweixintipios:IsNullOrUndefined(e._DSCallbacks.weixinIOSTipCallback)?DeepShare.dsLogDebug("weixin ios tip"):e._DSCallbacks.weixinIOSTipCallback();break;case D.destination.dstweibotipios:IsNullOrUndefined(e._DSCallbacks.weiboIOSTipCallback)?DeepShare.dsLogDebug("weibo ios tip"):e._DSCallbacks.weiboIOSTipCallback();break;case D.destination.dstqqtipios:IsNullOrUndefined(e._DSCallbacks.qqIOSTipCallback)?DeepShare.dsLogDebug("qq ios tip"):e._DSCallbacks.qqIOSTipCallback()}else if("android"===i)switch(n){case D.destination.dstweixintipandroid:IsNullOrUndefined(e._DSCallbacks.weixinAndroidTipCallback)?DeepShare.dsLogDebug("weixin android tip"):e._DSCallbacks.weixinAndroidTipCallback();break;case D.destination.dstweibotipandroid:IsNullOrUndefined(e._DSCallbacks.weiboAndroidTipCallback)?DeepShare.dsLogDebug("weibo android tip"):e._DSCallbacks.weiboAndroidTipCallback();break;case D.destination.dstqqtipandroid:IsNullOrUndefined(e._DSCallbacks.qqAndroidTipCallback)?DeepShare.dsLogDebug("qq android tip"):e._DSCallbacks.qqAndroidTipCallback()}r=n,k(D.actionJSDst,r)};var h=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(e._DSCallbacks.cannotDeeplinkCallback)?DeepShare.dsLogDebug("cannot deeplink"):e._DSCallbacks.cannotDeeplinkCallback(),r=D.destination.dstcannotdeeplink,k(D.actionJSDst,r)},f=function(){b.is_download_directly?L():b.cannot_go_market?C():b.cannot_get_win_event||b.is_uc?w():m()},w=function(){r=D.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+r),IsNullOrUndefined(e._DSCallbacks.androidMarketLandingCallback)?DeepShare.dsLogDebug("android market"):e._DSCallbacks.androidMarketLandingCallback(),k(D.actionJSDst,r)},C=function(){r=D.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+r),IsNullOrUndefined(e._DSCallbacks.androidCannotGoMarketLandingCallback)?DeepShare.dsLogDebug("android cannot go market"):e._DSCallbacks.androidCannotGoMarketLandingCallback(),k(D.actionJSDst,r)},L=function(){r=D.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+r),IsNullOrUndefined(e._DSCallbacks.androidDownloadLandingCallback)?(DeepShare.dsLogDebug("android downloading..."),I(b.url)):e._DSCallbacks.androidDownloadLandingCallback(),k(D.actionJSDst,r)},m=function(){r="market://details?id="+b.pkg,DeepShare.dsLogDebug("Go to android market: "+r),k(D.actionJSDst,r),p.windowLocation(r)},I=function(i){DeepShare.dsLogDebug("Goto url: "+i),r=i,k(D.actionJSDst,i),p.windowLocation(i)},v=function(i){"ios"===i?IsNullOrUndefined(e._DSCallbacks.iosPlatformNotAvailCallback)?DeepShare.dsLogDebug("ios platform not available"):e._DSCallbacks.iosPlatformNotAvailCallback():"android"===i&&(IsNullOrUndefined(e._DSCallbacks.androidPlatformNotAvailCallback)?DeepShare.dsLogDebug("android platform not available"):e._DSCallbacks.androidPlatformNotAvailCallback()),r=D.destination.dstplatformNA.replace(/{Platform}/g,i),k(D.actionJSDst,r)},O=function(i,e,n){s=i,DeepShare.dsLogDebug("deeplinklaunch: "+s),k(D.actionJSDeepLink,i),p.windowLocation(i);var a=setTimeout(function(){n()},e);_(a)},T=function(i,e){s=i;var n=null;try{k(D.actionJSDeepLink,i),n=p.windowOpen(i),DeepShare.dsLogDebug("chrome ios open pass")}catch(a){DeepShare.dsLogDebug("chrome ios open exception")}n?p.windowClose():e()},N=function(i,e,n){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+i);var a=setTimeout(function(){n()},e);_(a);var o=document.createElement("iframe");o.style.width="1px",o.style.height="1px",o.border="none",o.style.display="none",o.src=i,document.body.appendChild(o),s=i,k(D.actionJSDeepLink,i)},A=function(){return b.is_ios&&(void 0===b.bundle_id||""===b.bundle_id)},y=function(){return b.is_android&&(void 0===b.pkg||""===b.pkg)},q=function(){return void 0!==b.yyb_url&&""!==b.yyb_url},U=function(i,e,n){DeepShare.dsLogDebug("Deal with iOS: "+i+" dst: "+e+" url: "+n),b.ios_major<=8?IsNullOrUndefined(n)?_gotoTip(i,e):I(n):b.is_universal_link?I(b.ds_url):_gotoTip(i,e)};this.Start=function(){var i=this;S(!0),setTimeout(function(){i._Start()},300)},this._Start=function(){k("ds_jssdk_click","");var i="";if(A())return void v("ios");if(y())return void v("android");if(b.is_wechat)DeepShare.dsLogDebug("In WeChat"),q()?(DeepShare.dsLogDebug("YYBurl is: "+b.yyb_url),b.is_ios?U("ios",D.destination.dstweixintipios,b.yyb_url):I(b.yyb_url)):b.is_ios?(DeepShare.dsLogDebug("isIOS without YYBurl"),U("ios",D.destination.dstweixintipios)):b.is_android&&(DeepShare.dsLogDebug("isAndroid without YYBurl"),_gotoTip("android",D.destination.dstweixintipandroid));else if(b.is_qq)DeepShare.dsLogDebug("In QQ"),q()?(DeepShare.dsLogDebug("YYBurl is: "+b.yyb_url),b.is_ios?U("ios",D.destination.dstqqtipios,b.yyb_url):I(b.yyb_url)):b.is_ios?(DeepShare.dsLogDebug("isIOS"),U("ios",D.destination.dstqqtipios)):b.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",D.destination.dstqqtipandroid));else if(b.is_weibo)DeepShare.dsLogDebug("In Weibo"),b.is_ios?(DeepShare.dsLogDebug("isIOS"),U("ios",D.destination.dstweibotipios)):b.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",D.destination.dstweibotipandroid));else if(b.is_ios)DeepShare.dsLogDebug("In iOS"),i=b.scheme+"://",b.match_id&&b.match_id.length>0&&(i+="?click_id="+b.match_id),DeepShare.dsLogDebug("Deeplink url: "+i),b.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+b.ios_major),N(i,2e3,function(){I(b.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+b.ios_major),b.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),T(i,function(){I(b.url)})):b.is_universal_link?(DeepShare.dsLogDebug("isUniversallink = true"),I(b.ds_url)):(DeepShare.dsLogDebug("is safari"),O(i,500,function(){I(b.url)})));else if(b.is_android)if(DeepShare.dsLogDebug("In Android"),i=b.scheme+"://"+b.host,b.match_id&&b.match_id.length>0&&(i+="?click_id="+b.match_id),DeepShare.dsLogDebug("Deeplink url: "+i),b.cannot_deeplink)N(i,2e3,function(){h()});else if(b.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),q()?(DeepShare.dsLogDebug(b.yyb_url),I(b.yyb_url)):h();else if(b.is_uc)DeepShare.dsLogDebug("In UC browser"),N(i,5e3,function(){f()});else if(b.chrome_major>=25&&!b.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+b.chrome_major);var e=b.host;b.match_id&&b.match_id.length>0&&(e+="?click_id="+b.match_id);var a=b.pkg,o="intent://"+e+"#Intent;scheme="+toLowerCase(b.scheme)+";package="+a+";S.browser_fallback_url="+b.url+";end";O(o,2e3,function(){f()})}else DeepShare.dsLogDebug("In default browser"),N(i,2e3,function(){f()});c=n.DISMISSED},this.SetParam=function(i){g(i)},this.SetBindInfo=function(i){b=i},this.BindInAppInfo=function(){S()},g(i)}function IsNullOrEmpty(i){return!(i&&i.length>0)}function IsNullOrUndefined(i){return"undefined"==typeof i||null===i}function toLowerCase(i){return"string"==typeof i?i.toLowerCase():"undefined"==typeof object||null===object?"":(i=""+i,i.toLowerCase())}DeepShare.dsLogDebug=function(i){if(DeepShare.DEBUG){var e=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+e.toLocaleTimeString()+"] - "+i)}},DeepShare.DEBUG=!1;