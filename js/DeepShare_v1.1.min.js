function DeepShare(e){var i={INITIAL:0,BINDED:1,DISMISSED:2},n="https://",o="fds.so/",a="v2/",d="jsapi/",t="ds_tag",r="",l="",s=i.INITIAL,c={inapp_data:"",sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},u=null,p={weixinIOSTipCallback:function(){DeepShare.dsLogDebug("weixin ios tip")},weixinAndroidTipCallback:function(){DeepShare.dsLogDebug("weixin android tip")},weiboIOSTipCallback:function(){DeepShare.dsLogDebug("weibo ios tip")},weiboAndroidTipCallback:function(){DeepShare.dsLogDebug("weibo android tip")},qqIOSTipCallback:function(){DeepShare.dsLogDebug("qq ios tip")},qqAndroidTipCallback:function(){DeepShare.dsLogDebug("qq android tip")},cannotDeeplinkCallback:function(){DeepShare.dsLogDebug("cannot deeplink")},iosLandingCallback:function(){DeepShare.dsLogDebug("ios landing")},androidMarketLandingCallback:function(){DeepShare.dsLogDebug("android market")},androidDownloadLandingCallback:function(){DeepShare.dsLogDebug("android downloading..."),I(u.url)},androidCannotGoMarketLandingCallback:function(){DeepShare.dsLogDebug("android cannot go market")},iosPlatformNotAvailCallback:function(){DeepShare.dsLogDebug("ios platform not available")},androidPlatformNotAvailCallback:function(){DeepShare.dsLogDebug("android platform not available")}},g={windowLocation:function(e){window.location=e},windowOpen:function(e){window.open(e)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(e,i){window.addEventListener(e,i)},windowUrlAddTag:function(){if(window.location.search.indexOf(t)<0){var e=Math.floor(1e6*Math.random()),i="?"+t+"="+e;window.location.search=i,DeepShare.dsLogDebug("Url Add Tag:"+i)}},cookieEnabled:function(){var e=!1;try{localStorage.test=2}catch(i){DeepShare.dsLogDebug("private mode"),e=!0}return navigator.cookieEnabled&&!e}},b={trackingUrl:"v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},D=function(e){IsNullOrUndefined(e.app_id)||(c.app_id=e.app_id),IsNullOrUndefined(e.inapp_data)||(c.inapp_data=JSON.stringify(e.inapp_data)),IsNullOrUndefined(e.sender_id)||(c.sender_id=e.sender_id),IsNullOrUndefined(e.download_title)||(c.download_title=e.download_title),IsNullOrUndefined(e.download_msg)||(c.download_msg=e.download_msg),IsNullOrUndefined(e.download_btn_text)||(c.download_btn_text=e.download_btn_text),IsNullOrUndefined(e.download_url_ios)||(c.download_url_ios=e.download_url_ios),IsNullOrUndefined(e.download_url_android)||(c.download_url_android=e.download_url_android),IsNullOrUndefined(e.channels)||(c.channels=JSON.stringify(e.channels)),IsNullOrUndefined(e.callbacks)||(p=e.callbacks),f(!0)},f=function(t){if(DeepShare.dsLogDebug("Try refresh bind, force: "+t+", binded: "+s),t||s!==i.BINDED){var r=n+o+a+d+c.app_id;$.ajax({url:r,type:"POST",data:JSON.stringify(c),xhrFields:{withCredentials:!0},success:function(n){u=n,s=i.BINDED,DeepShare.dsLogDebug("Params from api:"+JSON.stringify(e)+JSON.stringify(n))},error:function(){DeepShare.dsLogDebug("Refresh Params Error")},dataType:"json"})}},w=function(e,i){var a={action:e,kvs:{click_id:u.match_id,destination:i,ds_tag:u.ds_tag}},d=n+o+b.trackingUrl+u.app_id,t=JSON.stringify(a);$.post(d,t,function(e){}).error(function(){})},h=function(e){g.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(e)}),g.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(e)}),g.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(e)}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(e))}),g.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(e)}),g.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),g.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(e)})};_gotoTip=function(e,i){if(DeepShare.dsLogDebug("Go to tip: "+i),"ios"===e)switch(i){case b.destination.dstweixintipios:IsNullOrUndefined(p.weixinIOSTipCallback)||p.weixinIOSTipCallback();break;case b.destination.dstweibotipios:IsNullOrUndefined(p.weiboIOSTipCallback)||p.weiboIOSTipCallback();break;case b.destination.dstqqtipios:IsNullOrUndefined(p.qqIOSTipCallback)||p.qqIOSTipCallback()}else if("android"===e)switch(i){case b.destination.dstweixintipandroid:IsNullOrUndefined(p.weixinAndroidTipCallback)||p.weixinAndroidTipCallback();break;case b.destination.dstweibotipandroid:IsNullOrUndefined(p.weiboAndroidTipCallback)||p.weiboAndroidTipCallback();break;case b.destination.dstqqtipandroid:IsNullOrUndefined(p.qqAndroidTipCallback)||p.qqAndroidTipCallback()}l=i,w(b.actionJSDst,l)};var k=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(p.cannotDeeplinkCallback)||p.cannotDeeplinkCallback(),l=b.destination.dstcannotdeeplink,w(b.actionJSDst,l)},S=function(){u.is_download_directly?C():u.cannot_go_market?L():u.cannot_get_win_event||u.is_uc?_():m()},_=function(){l=b.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+l),IsNullOrUndefined(p.androidMarketLandingCallback)||p.androidMarketLandingCallback(),w(b.actionJSDst,l)},L=function(){l=b.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+l),IsNullOrUndefined(p.androidCannotGoMarketLandingCallback)||p.androidCannotGoMarketLandingCallback(),w(b.actionJSDst,l)},C=function(){l=b.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+l),IsNullOrUndefined(p.androidDownloadLandingCallback)||p.androidDownloadLandingCallback(),w(b.actionJSDst,l)},m=function(){l="market://details?id="+u.pkg,DeepShare.dsLogDebug("Go to android market: "+l),w(b.actionJSDst,l),g.windowLocation(l)},I=function(e){DeepShare.dsLogDebug("Goto url: "+e),l=e,w(b.actionJSDst,e),g.windowLocation(e)},v=function(e){"ios"===e?IsNullOrUndefined(p.iosPlatformNotAvailCallback)||p.iosPlatformNotAvailCallback():"android"===e&&(IsNullOrUndefined(p.androidPlatformNotAvailCallback)||p.androidPlatformNotAvailCallback()),l=b.destination.dstplatformNA.replace(/{Platform}/g,e),w(b.actionJSDst,l)},O=function(e,i,n){r=e,DeepShare.dsLogDebug("deeplinklaunch: "+r),w(b.actionJSDeepLink,e),g.windowLocation(e);var o=setTimeout(function(){n()},i);h(o)},T=function(e,i){r=e;var n=null;try{w(b.actionJSDeepLink,e),n=g.windowOpen(e),DeepShare.dsLogDebug("chrome ios open pass")}catch(o){DeepShare.dsLogDebug("chrome ios open exception")}n?g.windowClose():i()},A=function(e,i,n){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+e);var o=setTimeout(function(){n()},i);h(o);var a=document.createElement("iframe");a.style.width="1px",a.style.height="1px",a.border="none",a.style.display="none",a.src=e,document.body.appendChild(a),r=e,w(b.actionJSDeepLink,e)},N=function(){return u.is_ios&&(void 0===u.bundle_id||""===u.bundle_id)},y=function(){return u.is_android&&(void 0===u.pkg||""===u.pkg)},q=function(){return void 0!==u.yyb_url&&""!==u.yyb_url},U=function(e,i,n){DeepShare.dsLogDebug("Deal with iOS: "+e+" dst: "+i+" url: "+n),u.ios_major<=8?IsNullOrUndefined(n)?_gotoTip(e,i):I(n):u.is_universal_link?I(u.ds_url):_gotoTip(e,i)};this.Start=function(){w("ds_jssdk_click","");var e="";if(N())return void v("ios");if(y())return void v("android");if(u.is_wechat)DeepShare.dsLogDebug("In WeChat"),q()?(DeepShare.dsLogDebug("YYBurl is: "+u.yyb_url),u.is_ios?U("ios",b.destination.dstweixintipios,u.yyb_url):I(u.yyb_url)):u.is_ios?(DeepShare.dsLogDebug("isIOS without YYBurl"),U("ios",b.destination.dstweixintipios)):u.is_android&&(DeepShare.dsLogDebug("isAndroid without YYBurl"),_gotoTip("android",b.destination.dstweixintipandroid));else if(u.is_qq)DeepShare.dsLogDebug("In QQ"),q()?(DeepShare.dsLogDebug("YYBurl is: "+u.yyb_url),u.is_ios?U("ios",b.destination.dstqqtipios,u.yyb_url):I(u.yyb_url)):u.is_ios?(DeepShare.dsLogDebug("isIOS"),U("ios",b.destination.dstqqtipios)):u.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",b.destination.dstqqtipandroid));else if(u.is_weibo)DeepShare.dsLogDebug("In Weibo"),u.is_ios?(DeepShare.dsLogDebug("isIOS"),U("ios",b.destination.dstweibotipios)):u.is_android&&(DeepShare.dsLogDebug("isAndroid"),_gotoTip("android",b.destination.dstweibotipandroid));else if(u.is_ios)DeepShare.dsLogDebug("In iOS"),e=u.scheme+"://",u.match_id&&u.match_id.length>0&&(e+="?click_id="+u.match_id),DeepShare.dsLogDebug("Deeplink url: "+e),u.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+u.ios_major),A(e,2e3,function(){I(u.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+u.ios_major),u.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),T(e,function(){I(u.url)})):u.is_universal_link?(DeepShare.dsLogDebug("isUniversallink = true"),I(u.ds_url)):(DeepShare.dsLogDebug("is safari"),O(e,500,function(){I(u.url)})));else if(u.is_android)if(DeepShare.dsLogDebug("In Android"),e=u.scheme+"://"+u.host,u.match_id&&u.match_id.length>0&&(e+="?click_id="+u.match_id),DeepShare.dsLogDebug("Deeplink url: "+e),u.cannot_deeplink)A(e,2e3,function(){k()});else if(u.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),q()?(DeepShare.dsLogDebug(u.yyb_url),f(),I(u.yyb_url)):k();else if(u.is_uc)DeepShare.dsLogDebug("In UC browser"),A(e,5e3,function(){S()});else if(u.chrome_major>=25&&!u.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+u.chrome_major);var n=u.host;u.match_id&&u.match_id.length>0&&(n+="?click_id="+u.match_id);var o=u.pkg,a="intent://"+n+"#Intent;scheme="+toLowerCase(u.scheme)+";package="+o+";S.browser_fallback_url="+u.url+";end";O(a,2e3,function(){S()})}else DeepShare.dsLogDebug("In default browser"),A(e,2e3,function(){S()});s=i.DISMISSED},this.SetParam=function(e){D(e)},this.SetBindInfo=function(e){u=e},this.BindInAppInfo=function(){f()},this.SetCallbackWeixinIOSTip=function(e){p.weixinIOSTipCallback=e},this.SetCallbackWeixinAndroidTip=function(e){p.weixinAndroidTipCallback=e},this.SetCallbackWeiboIOSTip=function(e){p.weiboIOSTipCallback=e},this.SetCallbackWeiboAndroidTip=function(e){p.weiboAndroidTipCallback=e},this.SetCallbackQQIOSTip=function(e){p.qqIOSTipCallback=e},this.SetCallbackQQAndroidTip=function(e){p.qqAndroidTipCallback=e},this.SetCallbackQQAndroidTip=function(e){p.qqAndroidTipCallback=e},this.SetCallbackIOSNotAvailable=function(e){p.iosPlatformNotAvailCallback=e},this.SetCallbackAndroidNotAvailable=function(e){p.androidPlatformNotAvailCallback=e},this.SetCallbackCannotDeeplink=function(e){p.cannotDeeplinkCallback=e},this.SetCallbackIOSLanding=function(e){p.iosLandingCallback=e},this.SetCallbackAndroidMarketLanding=function(e){p.androidMarketLandingCallback=e},this.SetCallbackAndroidDownloadLanding=function(e){p.androidDownloadLandingCallback=e},this.SetCallbackAndroidCannotGoMarketLanding=function(e){p.androidCannotGoMarketLandingCallback=e},D(e)}function IsNullOrEmpty(e){return!(e&&e.length>0)}function IsNullOrUndefined(e){return"undefined"==typeof e||null===e}function toLowerCase(e){return"string"==typeof e?e.toLowerCase():"undefined"==typeof object||null===object?"":(e=""+e,e.toLowerCase())}DeepShare.dsLogDebug=function(e){if(DeepShare.DEBUG){var i=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+i.toLocaleTimeString()+"] - "+e)}},DeepShare.DEBUG=!1;