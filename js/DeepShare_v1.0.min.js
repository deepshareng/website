function DeepShare(e){var a=this;this._deeplinkLocation="",this._dstLocation="",this._bindedDeepLink=DeepShare.BIND_STATUS.INITIAL,this._AppData={inapp_data:"",sender_id:"",app_id:"",download_title:"",download_msg:"",download_btn_text:"",download_url_ios:"",download_url_android:"",channels:[]},this._ResponseData=null,this._Params=null,this._DSCallbacks={weixinIOSTipCallback:function(){DeepShare.dsLogDebug("weixin ios tip")},weixinAndroidTipCallback:function(){DeepShare.dsLogDebug("weixin android tip")},weiboIOSTipCallback:function(){DeepShare.dsLogDebug("weibo ios tip")},weiboAndroidTipCallback:function(){DeepShare.dsLogDebug("weibo android tip")},qqIOSTipCallback:function(){DeepShare.dsLogDebug("qq ios tip")},qqAndroidTipCallback:function(){DeepShare.dsLogDebug("qq android tip")},cannotDeeplinkCallback:function(){DeepShare.dsLogDebug("cannot deeplink")},iosLandingCallback:function(){DeepShare.dsLogDebug("ios landing")},androidMarketLandingCallback:function(){DeepShare.dsLogDebug("android market")},androidDownloadLandingCallback:function(){DeepShare.dsLogDebug("android downloading..."),a._gotoUrl(a._Params.url)},androidCannotGoMarketLandingCallback:function(){DeepShare.dsLogDebug("android cannot go market")},iosPlatformNotAvailCallback:function(){DeepShare.dsLogDebug("ios platform not available")},androidPlatformNotAvailCallback:function(){DeepShare.dsLogDebug("android platform not available")}},this._env={windowLocation:function(e){window.location=e},windowOpen:function(e){window.open(e)},windowClose:function(){window.close()},windowChangeHistory:function(){window.history.replaceState("Object","Title","0")},windowAddEventListener:function(e,a){window.addEventListener(e,a)},windowUrlAddTag:function(){if(window.location.search.indexOf(DeepShare.kDSTag)<0){var e=Math.floor(1e6*Math.random()),a="?"+DeepShare.kDSTag+"="+e;window.location.search=a,DeepShare.dsLogDebug("Url Add Tag:"+a)}},cookieEnabled:function(){var e=!1;try{localStorage.test=2}catch(a){DeepShare.dsLogDebug("private mode"),e=!0}return navigator.cookieEnabled&&!e}},this._AppInsStatus={NotInstall:0,Installed:1,Unclear:2},this._DSAction={trackingUrl:"/v2/dsactions/",actionJSDeepLink:"js/deeplink",actionJSDst:"js/dst",actionJSUserClick:"js/userclick",destination:{dstweixintipandroid:"dst-weixin-tip-android",dstweixintipios:"dst-weixin-tip-ios",dstqqtipandroid:"dst-qq-tip-android",dstqqtipios:"dst-qq-tip-ios",dstweibotipandroid:"dst-weibo-tip-android",dstweibotipios:"dst-weibo-tip-ios",dstcannotdeeplink:"dst-cannot-deeplink",dstucbrowser:"dst-uc-browser",dstios9UniversalLinkLandPage:"dst-ios9-universallink-landpage",dstandroidDirectDownloadLandPage:"dst-android-direct-download-landpage",dstandroidMarketLandPage:"dst-android-market-landpage",dstandroidCannotGoMarketLandPage:"dst-android-cannot-gomarket-landpage",dstplatformNA:"dst-{Platform}-not-available"}},this._initialize(e)}function IsNullOrEmpty(e){return!(e&&e.length>0)}function IsNullOrUndefined(e){return"undefined"==typeof e||null===e}function toLowerCase(e){return"string"==typeof e?e.toLowerCase():"undefined"==typeof object||null===object?"":(e=""+e,e.toLowerCase())}DeepShare.dsLogDebug=function(e){if(DeepShare.DEBUG){var a=new Date;ws.readyState===ws.OPEN&&ws.send("[DEBUG] - ["+a.toLocaleTimeString()+"] - "+e)}},DeepShare.DEBUG=!1,DeepShare.BIND_STATUS={INITIAL:0,BINDED:1,DISMISSED:2},DeepShare.kPostVerb="POST",DeepShare.kRequestProtocol="https://",DeepShare.kServerName="fds.so/",DeepShare.kVersionName="v2/",DeepShare.kAPIJS="jsapi/",DeepShare.kAPIUrl="url/",DeepShare.kDSTag="ds_tag",DeepShare.prototype._initialize=function(e){IsNullOrUndefined(e.appID)||(this._AppData.app_id=e.appID),IsNullOrUndefined(e.inAppData)||(this._AppData.inapp_data=JSON.stringify(e.inAppData)),IsNullOrUndefined(e.senderID)||(this._AppData.sender_id=e.senderID),IsNullOrUndefined(e.downloadTitle)||(this._AppData.download_title=e.downloadTitle),IsNullOrUndefined(e.downloadMsg)||(this._AppData.download_msg=e.downloadMsg),IsNullOrUndefined(e.downloadBtnText)||(this._AppData.download_btn_text=e.downloadBtnText),IsNullOrUndefined(e.downloadUrlIOS)||(this._AppData.download_url_ios=e.downloadUrlIOS),IsNullOrUndefined(e.downloadUrlAndroid)||(this._AppData.download_url_android=e.downloadUrlAndroid),IsNullOrUndefined(e.channels)||(this._AppData.channels=JSON.stringify(e.channels)),IsNullOrUndefined(e.callbacks)||(this._DSCallbacks=e.callbacks),this._refreshBind(!0)},DeepShare.prototype._refreshBind=function(e){DeepShare.dsLogDebug("Try refresh bind, force: "+e+", binded: "+this._bindedDeepLink);var a=this;if(e||a._bindedDeepLink!==DeepShare.BIND_STATUS.BINDED){var i=DeepShare.kRequestProtocol+DeepShare.kServerName+DeepShare.kVersionName+DeepShare.kAPIJS+a._AppData.app_id;$.ajax({url:i,type:"POST",data:JSON.stringify(a._AppData),xhrFields:{withCredentials:!0},success:function(e){a._Params=e,a._bindedDeepLink=DeepShare.BIND_STATUS.BINDED,DeepShare.dsLogDebug("Params from api:"+JSON.stringify(params)+JSON.stringify(e))},error:function(){DeepShare.dsLogDebug("Refresh Params Error")},dataType:"json"})}},DeepShare.prototype._reportDSJSEvent=function(e,a){var i={action:e,kvs:{click_id:this._Params.match_id,destination:a,ds_tag:this._Params.ds_tag}},t=DeepShare.kRequestProtocol+DeepShare.kServerName+this._DSAction.trackingUrl+this._Params.app_id,o=JSON.stringify(i);$.post(t,o,function(e){}).error(function(){})},DeepShare.prototype._reportDSJSUserClickEvent=function(e,a,i){var t={action:e,kvs:{click_id:this._Params.match_id,user_btn:a,user_choice:i,ds_tag:this._Params.ds_tag}},o=DeepShare.kRequestProtocol+DeepShare.kServerName+this._DSAction.trackingUrl+this._Params.app_id,n=JSON.stringify(t);$.post(o,n,function(e){}).error(function(){})},DeepShare.prototype._clearTimeoutOnPageUnload=function(e){var a=this;a._env.windowAddEventListener("pagehide",function(){DeepShare.dsLogDebug("window event pagehide"),clearTimeout(e),a._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED}),a._env.windowAddEventListener("blur",function(){DeepShare.dsLogDebug("window event blur"),clearTimeout(e),a._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED}),a._env.windowAddEventListener("unload",function(){DeepShare.dsLogDebug("window event unload"),clearTimeout(e),a._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED}),document.addEventListener("webkitvisibilitychange",function(){DeepShare.dsLogDebug("window event webkitvisibilitychange"),document.webkitHidden&&(DeepShare.dsLogDebug("window is hidden"),clearTimeout(e),a._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED)}),a._env.windowAddEventListener("beforeunload",function(){DeepShare.dsLogDebug("window event beforeunload"),clearTimeout(e)}),a._env.windowAddEventListener("focus",function(){DeepShare.dsLogDebug("window event focus")}),a._env.windowAddEventListener("focusout",function(){DeepShare.dsLogDebug("Window event focusout"),clearTimeout(e),a._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED})},DeepShare.prototype._gotoTip=function(e,a){var i=this;if(DeepShare.dsLogDebug("Go to tip: "+a),"ios"===e)switch(a){case i._DSAction.destination.dstweixintipios:IsNullOrUndefined(i._DSCallbacks.weixinIOSTipCallback)||i._DSCallbacks.weixinIOSTipCallback();break;case i._DSAction.destination.dstweibotipios:IsNullOrUndefined(i._DSCallbacks.weiboIOSTipCallback)||i._DSCallbacks.weiboIOSTipCallback();break;case i._DSAction.destination.dstqqtipios:IsNullOrUndefined(i._DSCallbacks.qqIOSTipCallback)||i._DSCallbacks.qqIOSTipCallback()}else if("android"===e)switch(a){case i._DSAction.destination.dstweixintipandroid:IsNullOrUndefined(i._DSCallbacks.weixinAndroidTipCallback)||i._DSCallbacks.weixinAndroidTipCallback();break;case i._DSAction.destination.dstweibotipandroid:IsNullOrUndefined(i._DSCallbacks.weiboAndroidTipCallback)||i._DSCallbacks.weiboAndroidTipCallback();break;case i._DSAction.destination.dstqqtipandroid:IsNullOrUndefined(i._DSCallbacks.qqAndroidTipCallback)||i._DSCallbacks.qqAndroidTipCallback()}this._dstLocation=a,this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoCannotDeeplink=function(){DeepShare.dsLogDebug("cannot deeplink"),IsNullOrUndefined(this._DSCallbacks.cannotDeeplinkCallback)||this._DSCallbacks.cannotDeeplinkCallback(),this._dstLocation=this._DSAction.destination.dstcannotdeeplink,this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoAndroidNewInstall=function(){this._Params.is_download_directly?this._gotoAndroidDownloadUrl():this._Params.cannot_go_market?this._gotoAndroidCannotGoMarketLandingPage():this._Params.cannot_get_win_event||this._Params.is_uc?this._gotoAndroidMarketLandingPage():this._gotoAndroidMarket()},DeepShare.prototype._gotoIOSLandingPage=function(){this._dstLocation=this._DSAction.destination.dstios9UniversalLinkLandPage,DeepShare.dsLogDebug("Go to iOS landing page: "+this._dstLocation),IsNullOrUndefined(this._DSCallbacks.iosLandingCallback)||this._DSCallbacks.iosLandingCallback(),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoAndroidMarketLandingPage=function(){this._dstLocation=this._DSAction.destination.dstandroidMarketLandPage,DeepShare.dsLogDebug("Go to android market landing page: "+this._dstLocation),IsNullOrUndefined(this._DSCallbacks.androidMarketLandingCallback)||this._DSCallbacks.androidMarketLandingCallback(),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoAndroidCannotGoMarketLandingPage=function(){this._dstLocation=this._DSAction.destination.dstandroidCannotGoMarketLandPage,DeepShare.dsLogDebug("Go to android can not go to market landing page: "+this._dstLocation),IsNullOrUndefined(this._DSCallbacks.androidCannotGoMarketLandingCallback)||this._DSCallbacks.androidCannotGoMarketLandingCallback(),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoAndroidDownloadUrl=function(){this._dstLocation=this._DSAction.destination.dstandroidDirectDownloadLandPage,DeepShare.dsLogDebug("Go to android download landing page: "+this._dstLocation),IsNullOrUndefined(this._DSCallbacks.androidDownloadLandingCallback)||this._DSCallbacks.androidDownloadLandingCallback(),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._gotoAndroidMarket=function(){instance._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED,this._dstLocation="market://details?id="+this._Params.pkg,DeepShare.dsLogDebug("Go to android market: "+this._dstLocation),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation),this._env.windowLocation(this._dstLocation)},DeepShare.prototype._gotoUrl=function(e){DeepShare.dsLogDebug("Goto url: "+e),this._dstLocation=e,this._reportDSJSEvent(this._DSAction.actionJSDst,e),this._env.windowLocation(e)},DeepShare.prototype._gotoPlatformNotAvail=function(e){"ios"===e?IsNullOrUndefined(this._DSCallbacks.iosPlatformNotAvailCallback)||this._DSCallbacks.iosPlatformNotAvailCallback():"android"===e&&(IsNullOrUndefined(this._DSCallbacks.androidPlatformNotAvailCallback)||this._DSCallbacks.androidPlatformNotAvailCallback()),this._dstLocation=this._DSAction.destination.dstplatformNA.replace(/{Platform}/g,e),this._reportDSJSEvent(this._DSAction.actionJSDst,this._dstLocation)},DeepShare.prototype._deeplinkLaunch=function(e,a,i){this._deeplinkLocation=e,DeepShare.dsLogDebug("deeplinklaunch: "+this._deeplinkLocation),this._reportDSJSEvent(this._DSAction.actionJSDeepLink,e),this._env.windowLocation(e);var t=setTimeout(function(){i()},a);this._clearTimeoutOnPageUnload(t)},DeepShare.prototype._chiosDeeplinkLaunch=function(e,a){this._deeplinkLocation=e;var i=null;try{this._reportDSJSEvent(this._DSAction.actionJSDeepLink,e),i=this._env.windowOpen(e),DeepShare.dsLogDebug("pass"),instance._bindedDeepLink=DeepShare.BIND_STATUS.DISMISSED}catch(t){DeepShare.dsLogDebug("exception")}i?this._env.windowClose():a()},DeepShare.prototype._iframeDeeplinkLaunch=function(e,a,i){DeepShare.dsLogDebug("Go to iframeDeeplinkLaunch: "+e);var t=setTimeout(function(){i()},a);this._clearTimeoutOnPageUnload(t);var o=document.createElement("iframe");o.style.width="1px",o.style.height="1px",o.border="none",o.style.display="none",o.src=e,document.body.appendChild(o),this._deeplinkLocation=e,this._reportDSJSEvent(this._DSAction.actionJSDeepLink,e)},DeepShare.prototype._isIosNotAvailable=function(){return this._Params.is_ios&&(void 0===this._Params.bundle_id||""===this._Params.bundle_id)},DeepShare.prototype._isAndroidNotAvailable=function(){return this._Params.is_android&&(void 0===this._Params.pkg||""===this._Params.pkg)},DeepShare.prototype._shouldGotoYYB=function(){return void 0!==this._Params.yyb_url&&""!==this._Params.yyb_url},DeepShare.prototype._getDeepLinkUrl=function(){var e=instance._Params.scheme+"://";return instance._Params.match_id&&instance._Params.match_id.length>0&&(e+="?click_id="+instance._Params.match_id),e=instance._Params.scheme+"://"+instance._Params.host,instance._Params.match_id&&instance._Params.match_id.length>0&&(e+="?click_id="+instance._Params.match_id),void 0!==this._Params.yyb_url&&""!==this._Params.yyb_url},DeepShare.prototype._dealIOS=function(e,a,i){DeepShare.dsLogDebug("Deal with iOS: "+e+" dst: "+a+" url: "+i),this._Params.ios_major<=8?IsNullOrUndefined(i)?this._gotoTip(e,a):this._gotoUrl(i):this._Params.is_universal_link?this._gotoUrl(this._Params.ds_url):this._gotoTip(e,a)},DeepShare.prototype.Start=function(){this._reportDSJSEvent("ds_jssdk_click","");var e=this,a="";if(e._isIosNotAvailable())return void e._gotoPlatformNotAvail("ios");if(e._isAndroidNotAvailable())return void e._gotoPlatformNotAvail("android");if(e._Params.is_wechat)DeepShare.dsLogDebug("In WeChat"),e._shouldGotoYYB()?(DeepShare.dsLogDebug("YYBurl is: "+e._Params.yyb_url),e._Params.is_ios?e._dealIOS("ios",e._DSAction.destination.dstweixintipios,this._Params.yyb_url):e._gotoUrl(e._Params.yyb_url)):e._Params.is_ios?(DeepShare.dsLogDebug("isIOS without YYBurl"),e._dealIOS("ios",e._DSAction.destination.dstweixintipios)):e._Params.is_android&&(DeepShare.dsLogDebug("isAndroid without YYBurl"),e._gotoTip("android",e._DSAction.destination.dstweixintipandroid));else if(e._Params.is_qq)DeepShare.dsLogDebug("In QQ"),e._shouldGotoYYB()?(DeepShare.dsLogDebug("YYBurl is: "+e._Params.yyb_url),e._Params.is_ios?e._dealIOS("ios",e._DSAction.destination.dstqqtipios,e._Params.yyb_url):e._gotoUrl(e._Params.yyb_url)):e._Params.is_ios?(DeepShare.dsLogDebug("isIOS"),e._dealIOS("ios",e._DSAction.destination.dstqqtipios)):e._Params.is_android&&(DeepShare.dsLogDebug("isAndroid"),e._gotoTip("android",e._DSAction.destination.dstqqtipandroid));else if(e._Params.is_weibo)DeepShare.dsLogDebug("In Weibo"),e._Params.is_ios?(DeepShare.dsLogDebug("isIOS"),e._dealIOS("ios",e._DSAction.destination.dstweibotipios)):e._Params.is_android&&(DeepShare.dsLogDebug("isAndroid"),e._gotoTip("android",e._DSAction.destination.dstweibotipandroid));else if(e._Params.is_ios)DeepShare.dsLogDebug("In iOS"),a=e._Params.scheme+"://",e._Params.match_id&&e._Params.match_id.length>0&&(a+="?click_id="+e._Params.match_id),DeepShare.dsLogDebug("Deeplink url: "+a),e._Params.ios_major<9?(DeepShare.dsLogDebug("IOS Major below 9:"+e._Params.ios_major),e._iframeDeeplinkLaunch(a,2e3,function(){e._gotoUrl(e._Params.url)})):(DeepShare.dsLogDebug("IOS Major upper 9:"+e._Params.ios_major),e._Params.chrome_major>0?(DeepShare.dsLogDebug("isChrome"),e._chiosDeeplinkLaunch(a,function(){e._gotoUrl(e._Params.url)})):e._Params.is_universal_link?(DeepShare.dsLogDebug("isUniversallink = true"),e._gotoUrl(e._Params.ds_url)):(DeepShare.dsLogDebug("is safari"),e._deeplinkLaunch(a,500,function(){e._gotoUrl(e._Params.url)})));else if(e._Params.is_android)if(DeepShare.dsLogDebug("In Android"),a=e._Params.scheme+"://"+e._Params.host,e._Params.match_id&&e._Params.match_id.length>0&&(a+="?click_id="+e._Params.match_id),DeepShare.dsLogDebug("Deeplink url: "+a),e._Params.cannot_deeplink)e._iframeDeeplinkLaunch(a,2e3,function(){e._gotoCannotDeeplink()});else if(e._Params.is_qq_browser)DeepShare.dsLogDebug("In QQ browser"),e._shouldGotoYYB()?(DeepShare.dsLogDebug(e._Params.yyb_url),e._gotoUrl(e._Params.yyb_url)):e._gotoCannotDeeplink();else if(e._Params.is_uc)DeepShare.dsLogDebug("In UC browser"),e._iframeDeeplinkLaunch(a,5e3,function(){e._gotoAndroidNewInstall()});else if(e._Params.chrome_major>=25&&!e._Params.force_use_scheme){DeepShare.dsLogDebug("In chrome major >= 25, Chrome_major:"+e._Params.chrome_major);var i=e._Params.host;e._Params.match_id&&e._Params.match_id.length>0&&(i+="?click_id="+e._Params.match_id);var t=e._Params.pkg,o="intent://"+i+"#Intent;scheme="+toLowerCase(e._Params.scheme)+";package="+t+";S.browser_fallback_url="+e._Params.url+";end";e._deeplinkLaunch(o,2e3,function(){e._gotoAndroidNewInstall()})}else DeepShare.dsLogDebug("In default browser"),e._iframeDeeplinkLaunch(a,2e3,function(){e._gotoAndroidNewInstall()})},DeepShare.prototype.SetParam=function(e){this._initialize(e)},DeepShare.prototype.SetBindInfo=function(e){this._Params=e},DeepShare.prototype.BindInAppInfo=function(){this._refreshBind()},DeepShare.prototype.SetCallbackWeixinIOSTip=function(e){this._DSCallbacks.weixinIOSTipCallback=e},DeepShare.prototype.SetCallbackWeixinAndroidTip=function(e){this._DSCallbacks.weixinAndroidTipCallback=e},DeepShare.prototype.SetCallbackWeiboIOSTip=function(e){this._DSCallbacks.weiboIOSTipCallback=e},DeepShare.prototype.SetCallbackWeiboAndroidTip=function(e){this._DSCallbacks.weiboAndroidTipCallback=e},DeepShare.prototype.SetCallbackQQIOSTip=function(e){this._DSCallbacks.qqIOSTipCallback=e},DeepShare.prototype.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},DeepShare.prototype.SetCallbackQQAndroidTip=function(e){this._DSCallbacks.qqAndroidTipCallback=e},DeepShare.prototype.SetCallbackIOSNotAvailable=function(e){this._DSCallbacks.iosPlatformNotAvailCallback=e},DeepShare.prototype.SetCallbackAndroidNotAvailable=function(e){this._DSCallbacks.androidPlatformNotAvailCallback=e},DeepShare.prototype.SetCallbackCannotDeeplink=function(e){this._DSCallbacks.cannotDeeplinkCallback=e};